<%- include('../partials/navbar') %>
<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
    <path fill="#ff5500" fill-opacity="1" d="M0,128L48,112C96,96,192,64,288,53.3C384,43,480,53,576,96C672,139,768,213,864,224C960,235,1056,181,1152,160C1248,139,1344,149,1392,154.7L1440,160L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path>
</svg>
<div class="container">
    <%- include('../partials/messages') %>
    <% if (dude.isBanned) { %>
        <img src="<%= dude.avatar %>" alt="guest" width="100" height="100" style="border-radius: 50%;" class="pt-10 mx-auto">
        <h1 class="text-center pt-4 mb-10"><%= dude.name %></h1>
        <h1 class="text-center">This user is banned</h1>
        <% if (user.isAdmin) { %>
            <div class="text-center pt-4">
                <%- include('_actions.ejs', { action: "Unban", user: dude, shortAction: "unban", method: "PUT"}) %>
            </div>
        <% } %>
    <% } else { %>

        <img src="<%= dude.avatar %>" alt="guest" width="100" height="100" style="border-radius: 50%;" class="pt-10 mx-auto">
        <h1 class="text-center pt-4"><%= dude.name %></h1>
        <h3 class="text-center pt-4"><%= dude.bio || "No bio" %></h3>
        <div class="flex flex-col">
            <h4 class="text-center pt-4"><a href="/users/<%= dude.slug %>/followers" style="text-decoration: none;">Followers: <%= dude.followers.length %></a></h4>
            <h4 class="text-center pt-4"><a href="/users/<%= dude.slug %>/following" style="text-decoration: none;">Following: <%= dude.following.length %></a></h4>
            <%- include('_follow', { dude: dude }) %>
            <% if (user && user.isAdmin && dude.isBanned == false) { %>
                <div class="text-center pt-4">
                    <%- include('_actions.ejs', { action: "Ban", user: dude, shortAction: "ban", method: "POST"}) %>
                </div>
            <% } %>
        </div>
        <p class="text-center text-muted pt-1">ID: <%= dude.uid %></p>
        <div class="btn-group d-flex justify-content-center" role="group" aria-label="Basic outlined example">
            <button type="button" class="btn btn-outline-primary" onclick="showArticles()">Articles</button>
            <button type="button" class="btn btn-outline-primary" onclick="showStats()">Stats</button>
        </div>
        <div id="articles" class="hidden">
            <% if (articles.length > 0) { %>
                <h1 class="mt-4 mb-4"><%= dude.name %>'s Blogs</h1>
                <% articles.forEach(article => { %>
                    <div class="card mt-4">
                        <div class="card-body">
                            <h4 class="card-title"><%= article.title %></h4>
                            <div class="card-subtitle text-muted mb-2">
                                <%= article.createdAt.toLocaleDateString() %>
                            </div>
                            <div class="card-text mb-2">
                                <%= article.description.substr(0, 50) %>...
                            </div>
                            <a href="/articles/<%= article.slug %>" class="btn btn-primary">Read more</a>
                            <% if (user && article.author === user.uid) { %>
                                <a href="/articles/edit/<%= article.id %>" class="btn btn-info">Edit</a>
                                <form action="/articles/<%= article.id %>?_method=DELETE" method="POST" class="d-inline">
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% }else { %>
                <img src="../../public/emojis/cricket.svg" alt="cricket" width="300" height="300" class="mx-auto">
                <div class="text-center">
                    <h1>*Cricket noises*</h1>
                    <br>
                    <h2>This user has no posts</h2>
                </div>
            <% } %>
        </div>
        <div id="stats" class="hidden">
            <h1 class="mt-4 mb-4">Stats</h1>
            <h4 class="mb-4">Total posts: <%= articles.length %></h4>
            <% if (dude.isAdmin) { %>
                <h4 class="mb-4">Role: Admin</h4>
            <% }else { %>
                <h4 class="mb-4">Role: User</h4>
            <% } %>
            <h4 class="mb-4">Reputation</h4>
            <h4 class="mb-4">Account created at: <%= moment.utc(dude.registeredAt).format("dddd, MMMM Do YYYY") %></h4>
        </div>

    <% } %>
    
</div>
<script>
    function showArticles() {
        
        const articlesDiv = document.getElementById("articles");
        if (articlesDiv.style.display === "block") {
            articlesDiv.style.display = "none";
        } else {
            articlesDiv.style.display = "block";
        }

    }
    function showStats() {

        const statsDiv = document.getElementById("stats");
        if (statsDiv.style.display === "block") {
            statsDiv.style.display = "none";
        } else {
            statsDiv.style.display = "block";
        }

    }
</script>