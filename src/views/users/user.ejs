<div class="container">
  <%- include('../partials/messages') %> <% if (dude.isBanned) { %>
  <img
    src="<%= dude.avatar %>"
    alt="guest"
    width="100"
    height="100"
    style="border-radius: 50%"
    class="pt-10 mx-auto"
  />
  <h1 class="text-center pt-4 mb-10"><%= dude.name %></h1>
  <h1 class="text-center">This user is banned</h1>
  <% if (user.isAdmin) { %>
  <div class="text-center pt-4">
    <%- include('_actions.ejs', { action: "Unban", user: dude, shortAction:
    "unban", method: "PUT"}) %>
  </div>
  <% } %> <% } else { %>

  <img
    src="<%= dude.avatar %>"
    alt="guest"
    width="100"
    height="100"
    style="border-radius: 50%"
    class="pt-10 mx-auto"
  />
  <h1 class="text-center pt-4"><%= dude.name %></h1>
  <h3 class="text-center pt-4"><%= dude.bio || "No bio" %></h3>
  <div class="flex flex-col">
    <div class="text-center pt-4">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#followersModal">
        Followers: <%= dude.followers.length %>
      </button>
      <div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="followersModalLabel"><%= dude.name %>'s followers:</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <% if (followers.length > 0) { %>
                <% followers.forEach((d) => { %>
                <div class="card">
                  <div class="card-body">
                    <h1 class="inline-block align-middle">
                      <img
                        src="<%= d.avatar %>"
                        alt="avatar"
                        width="50"
                        class="inline-block align-middle"
                        style="border-radius: 50%"
                      /><a href="/users/<%= d.slug %>" style="text-decoration: none"
                        ><%= d.name %></a
                      >
                    </h1>
                  </div>
                </div>
                <% }) %> <% } else { %>
                <div class="text-center">
                  <img
                    src="../../public/emojis/cricket.svg"
                    alt="cricket"
                    width="200"
                    height="200"
                    class="mx-auto mb-4"
                  />
                  <h1>*Cricket noises*</h1>
                  <br />
                  <h3 class="mb-4"><%= dude.name %> has no followers</h3>
                </div>
                <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="text-center pt-4 pb-4">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#followingModal">
        Following: <%= dude.following.length %>
      </button>
      <div class="modal fade" id="followingModal" tabindex="-1" aria-labelledby="followingModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="followingModalLabel"><%= dude.name %>'s following:</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <% if (following.length > 0) { %>
                <% following.forEach((d) => { %>
                <div class="card">
                  <div class="card-body">
                    <h1 class="inline-block align-middle">
                      <img
                        src="<%= d.avatar %>"
                        alt="avatar"
                        width="50"
                        class="inline-block align-middle"
                        style="border-radius: 50%"
                      /><a href="/users/<%= d.slug %>" style="text-decoration: none"
                        ><%= d.name %></a
                      >
                    </h1>
                  </div>
                </div>
                <% }) %> <% } else { %>
                <div class="text-center">
                  <img
                    src="../../public/emojis/cricket.svg"
                    alt="cricket"
                    width="200"
                    height="200"
                    class="mx-auto mb-4"
                  />
                  <h1>*Cricket noises*</h1>
                  <br />
                  <h3 class="mb-4"><%= dude.name %> has no followings</h3>
                </div>
                <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <%- include('_follow', { dude: dude }) %>
    <%- include('_rep', { dude: dude}) %>
    <% if (user && user.isAdmin && dude.isBanned == false) { %>
    <div class="text-center pt-4">
      <%- include('_actions.ejs', { action: "Ban", user: dude, shortAction:
      "ban", method: "POST"}) %>
    </div>
    <% } %>
  </div>
  <p class="text-center text-muted pt-1">ID: <%= dude.uid %></p>
  <div
    class="btn-group d-flex justify-content-center"
    role="group"
    aria-label="Basic outlined example"
  >
    <button
      type="button"
      class="btn btn-outline-primary"
      onclick="showArticles()"
    >
      Articles
    </button>
    <button type="button" class="btn btn-outline-primary" onclick="showStats()">
      Stats
    </button>
  </div>
  <div id="articles" class="hidden">
    <% if (articles.length > 0) { %>
    <h1 class="mt-4 mb-4"><%= dude.name %>'s Blogs</h1>
    <% articles.forEach(article => { %>
    <div class="card mt-4">
      <div class="card-body">
        <h4 class="card-title"><%= article.title %></h4>
        <div class="card-subtitle text-muted mb-2">
          <%= article.createdAt.toLocaleDateString() %>
        </div>
        <div class="card-text mb-2">
          <%= article.description.substr(0, 50) %>...
        </div>
        <a href="/articles/<%= article.slug %>" class="btn btn-primary"
          >Read more</a
        >
        <% if (user && article.author === user.uid) { %>
        <a href="/articles/edit/<%= article.id %>" class="btn btn-info">Edit</a>
        <form
          action="/articles/<%= article.id %>?_method=DELETE"
          method="POST"
          class="d-inline"
        >
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
        <% } %>
      </div>
    </div>
    <% }) %> <% }else { %>
    <img
      src="../../public/emojis/cricket.svg"
      alt="cricket"
      width="300"
      height="300"
      class="mx-auto"
    />
    <div class="text-center">
      <h1>*Cricket noises*</h1>
      <br />
      <h2>This user has no posts</h2>
    </div>
    <% } %>
  </div>
  <div id="stats" class="hidden">
    <h1 class="mt-4 mb-4">Stats</h1>
    <h4 class="mb-4">Total posts: <%= articles.length %></h4>
    <% if (dude.isAdmin) { %>
    <h4 class="mb-4">Role: Admin</h4>
    <% }else { %>
    <h4 class="mb-4">Role: User</h4>
    <% } %>
    <h4 class="mb-4">Reputation</h4>
    <h4 class="mb-4">
      Account created at: <%= moment.utc(dude.registeredAt) %>
    </h4>
  </div>

  <% } %>
</div>
<script>
  function showArticles() {
    const articlesDiv = document.getElementById("articles");
    if (articlesDiv.style.display === "block") {
      articlesDiv.style.display = "none";
    } else {
      articlesDiv.style.display = "block";
    }
  }
  function showStats() {
    const statsDiv = document.getElementById("stats");
    if (statsDiv.style.display === "block") {
      statsDiv.style.display = "none";
    } else {
      statsDiv.style.display = "block";
    }
  }
</script>
